{% macro blockstart(block, level) %}
    <div id="{{ block.code|default(block.cfMeta.itemId)|slugify }}" class="cf-{{ block.cfMeta.contentType }}" data-cf-url="{{ block.cfMeta.url }}">
{% endmacro %}

{% macro blockend(block) %}
    </div>
{% endmacro %}

{% macro contentBlock(block, level, nchild, width) %}
    {% set nchild = nchild|default(1) %}
    {% set width = width|default(12) %}
    <div class="span{{ width }} cf-level-{{ level }} cf-child-{{ nchild }}" ng-controller="BlockController">
        {% if block.title is defined %}
            <h{{ level }} >{{ block.title }}</h{{ level }}>
        {% endif %}
        {% if block.text is defined %}
            <div class="cfblock-text">
                {{ block.text|markdown }}
            </div>
        {% endif %}
        {% if block.textMore is defined %}
            <nav class="expand-text">
                <a href="#{{ block.code|default(block.cfMeta.itemId)|slugify }}" ng-click="textMoreVisible=1" ng-hide="textMoreVisible" class="more">{% trans %}expand.text.label{% endtrans %}</a>
            </nav>
            <div class="cfblock-textMore" ng-show="textMoreVisible">
                {{ block.textMore|markdown }}
            </div>
            <nav class="expand-text">
                <a href="#{{ block.code|default(block.cfMeta.itemId)|slugify }}" ng-click="textMoreVisible=0" ng-show="textMoreVisible" class="less">{% trans %}contract.text.label{% endtrans %}</a>
            </nav>
        {% endif %}
    </div>
{% endmacro %}

{% macro block_child(block, child, level, nchild, width) %}
    {% if block.behaviour is defined and "enumerate_children" in block.behaviour %}
        <div class="span2 cf-level-{{ level }} cf-child-{{ nchild }}">
            <div class="cf-child-enumeration">{{ nchild }}</div>
        </div>
        {{ _self.block(child, level, nchild, width - 2) }}
    {% else %}
    {{ _self.block(child, level, nchild, width) }}
    {% endif %}
{% endmacro %}

{% macro block(block, level, nchild, width) %}
    {{ _self.blockstart(block) }}
    {{ _self.contentBlock(block, level, nchild, width) }}
    {% if block.image.file is defined %}
        <div class="row-fluid">
            <div class="span12">
                <img src="{{ block.image.file.url }}" alt="{{ block.image.title }}" title="{% if block.image.description is defined %}{{ block.image.description }}{% endif %}">
            </div>
        </div>
    {% endif %}
    {% if block.video is defined %}
        <iframe width="569" height="320" src="{{ block.video.embed_url }}" frameborder="0" allowfullscreen></iframe>
    {% endif %}
    {% if block.children is defined %}
        {% if block.behaviour is defined and "column_children" in block.behaviour %}
            <div class="row-fluid cf-columns">
            {% for child in block.children %}
                {{ _self.block_child(block, child, level+1, loop.index, 12 / loop.length) }}
            {% endfor %}
            </div>
        {% else %}
            {% for child in block.children %}
                <div class="row-fluid">
                    {{ _self.block_child(block, child, level+1, loop.index, 12) }}
                </div>
            {% endfor %}
        {% endif %}
    {% endif %}
    {{ _self.blockend(block) }}
{% endmacro %}


