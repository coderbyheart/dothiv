{% trans_default_domain "charity" %}
{% use "DothivCharityWebsiteBundle:partials:blocks.html.twig" %}

{% set intro = content('Block', 'domain.claim') %}
{% set claimerror = intro.children[0] %}

<div class="container">

    {# Domain claim #}
    <div data-ng-controller="AccountDomainClaimController">
        <div data-ng-show="state==0">
            <div class="row">
                <div class="span12 profile-heading">
                    <div class="well">
                        <h3>{{ intro.title }}</h3>

                        {% if intro.text is defined %}
                            {{ intro.text|markdown }}
                        {% endif %}

                        <form novalidate>
                            <label for="claimToken">{% trans %}profile.domain.claim.token.label{% endtrans %}</label>
                            <input type="text" id="claimToken" data-ng-model="token" required>
                            <button type="submit" class="pull-right btn btn-primary" data-ng-disabled="!token" data-ng-click="register(token)">
                                {% trans %}profile.domain.claim.token.button{% endtrans %}
                            </button>
                        </form>

                    </div>
                </div>
            </div>
        </div>
        <div data-ng-show="state==1">
            <div class="row">
                <div class="span12 profile-heading">
                    <div class="well">
                        <p class="text-center">{{ block('loading') }}</p>
                    </div>
                </div>
            </div>
        </div>
        <div data-ng-show="state==2">
            <div class="row">
                <div class="span12 profile-heading">
                    <div class="well">
                        <h3>{% trans %}profile.domain.claim.success.headline{% endtrans %}</h3>

                        <p><strong><em>{% trans %}profile.domain.claim.success.text{% endtrans %}</em></strong></p>

                        <div class="row-fluid">
                            <div class="span4">
                                <iframe width="300" height="169" src="//www.youtube.com/embed/l3ZHd8qbSpE" allowfullscreen></iframe>
                            </div>
                            <div class="span4">
                                <p>
                                    <strong><em>{% trans %}profile.domain.claim.success.col2.headline{% endtrans %}</em></strong>
                                </p>

                                <p>{% trans %}profile.domain.claim.success.col2.text{% endtrans %}</p>
                                <a href="#"><span>{% trans %}profile.domain.claim.success.col2.link{% endtrans %}</span>

                                    <div class="headidata-ng-arrow"></div>
                                </a>
                            </div>
                            <div class="span4">
                                <p>
                                    <strong><em>{% trans %}profile.domain.claim.success.col3.headline{% endtrans %}</em></strong>
                                </p>

                                <p>{% trans %}profile.domain.claim.success.col3.text{% endtrans %}</p>
                                <a href="#"><span>{% trans %}profile.domain.claim.success.col3.link{% endtrans %}</span>

                                    <div class="headidata-ng-arrow"></div>
                                </a>
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span12">
                                <p>
                                    <a href="" class="btn btn-primary pull-right" data-ng-click="edit()">{% trans %}
                                        profile.domain.success.button{% endtrans %}</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div data-ng-show="state==3">
            <div class="row">
                <div class="span12">
                    <div class="well">
                        <h3>{{ claimerror.title }}</h3>
                        <div class="row-fluid">
                            <div class="span10">
                                {% if claimerror.text is defined %}
                                    {{ claimerror.text|markdown }}
                                {% endif %}
                            </div>
                            <div class="span2">
                                <button type="submit" class="btn btn-primary pull-right" data-ng-click="startover()">{% trans %}
                                    profile.domain.claim.error.button{% endtrans %}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="span12"></div>
            </div>
        </div>
    </div>

    {# Domains #}
    <div data-ng-controller="AccountProfileDomainController" class="profile-summary-domains">
        <div data-ng-hide="domains.$resolved">
            <p class="text-center">{{ block('loading') }}</p>
        </div>
        <div data-ng-show="domains.$resolved">
            <div class="row">
                <div class="span12">
                    <header>
                        <h3>{% trans %}account.profile.domains.overview{% endtrans %}</h3>

                        <a href="{{ path('dothiv_registry_register', {'locale': 'en'}) }}">{% trans %}
                            profile.overview.domain.button{% endtrans %}</a>

                        <form class="form-search" data-ng-show="domains.length > itemsPerPage" novalidate>
                            <input type="text" class="input-medium search-query" data-ng-model='searchText.name' placeholder="{% trans %}generic.searchinput{% endtrans %}">
                        </form>

                    </header>
                    <ul>
                        <li class="item" data-ng-repeat="domain in (domains | filter:searchText | limitTo:(searchText.name ? domains.length : pageLength))">
                            <h4 data-ng-bind="domain.name"></h4>

                            <p>
                                <span class="domain-clicks">{% trans %}domains.clicks.label{% endtrans %}</span>
                            </p>
                            <a href="" data-ng-click="edit(domain)">{% trans %}
                                account.profile.domains.edit{% endtrans %}</a>
                        </li>
                        <li data-ng-hide="(pageLength >= domains.length) || searchText.name">
                            <button class="next-page" data-ng-click="pageLength = pageLength + itemsPerPage">
                                {% trans %}generic.showmore{% endtrans %}
                            </button>
                        </li>
                        <li data-ng-show="(domains | filter:searchText | limitTo:(searchText.name ? domains.length : pageLength)).length == 0">
                            <p>{% trans %}error.nodomains{% endtrans %}</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>
